machine:
  services:
    - docker
checkout:
    post:
        - mkdir -p $HOME/src/github.com/fairlance/backend
        - cp -Rf ./* ./../src/github.com/fairlance/backend # move to src folder so make executes tasks there
dependencies:
    override:
        - make installDependencies
        - sudo chmod +x fairlance.sh
        - ./fairlance.sh dependancies
test:
    override:
        - make test
    post:
        - make install
        - make installARM
        - sudo cp * $CIRCLE_ARTIFACTS:
            pwd: ./../bin
        - ./fairlance.sh buildAll:
            pwd: ./../src/github.com/fairlance/backend
        - mkdir images:
            pwd: ./../src/github.com/fairlance/backend
        - ./fairlance.sh saveImages:
            pwd: ./../src/github.com/fairlance/backend
        - sudo cp -Rf images $CIRCLE_ARTIFACTS:
            pwd: ./../src/github.com/fairlance/backend
